input {
  # System logs
  file {
    path => "/var/log/nostrbots/*.log"
    type => "nostrbots-logs"
    start_position => "beginning"
  }
  
  # Audit logs
  file {
    path => "/var/log/nostrbots/audit.log"
    type => "audit-logs"
    start_position => "beginning"
  }
  
  # Security monitor logs
  file {
    path => "/var/log/nostrbots/security-monitor.log"
    type => "security-logs"
    start_position => "beginning"
  }
}

filter {
  
  # Parse Nostrbots application logs
  if [type] == "nostrbots-logs" {
    grok {
      match => { "message" => "\[%{TIMESTAMP_ISO8601:timestamp}\] %{WORD:level}: %{GREEDYDATA:log_message}" }
    }
    
    date {
      match => [ "timestamp", "ISO8601" ]
    }
  }
  
  # Parse audit logs
  if [type] == "audit-logs" {
    grok {
      match => { "message" => "\[%{TIMESTAMP_ISO8601:timestamp}\] %{WORD:event_type}: %{GREEDYDATA:audit_message}" }
    }
    
    date {
      match => [ "timestamp", "ISO8601" ]
    }
  }
  
  # Parse security logs
  if [type] == "security-logs" {
    grok {
      match => { "message" => "\[%{TIMESTAMP_ISO8601:timestamp\] %{WORD:level}: %{GREEDYDATA:security_message}" }
    }
    
    date {
      match => [ "timestamp", "ISO8601" ]
    }
  }
  
  # Add common fields
  mutate {
    add_field => { "service" => "nostrbots" }
    add_field => { "environment" => "production" }
  }
}

output {
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    index => "nostrbots-logs-%{+YYYY.MM.dd}"
  }
  
  # Also output to stdout for debugging
  stdout {
    codec => rubydebug
  }
}
