<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nostrbots Desktop - Document Parser</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">
                <h1>üöÄ Nostrbots Desktop</h1>
                <p>Convert documents to Nostr publications</p>
            </div>
        </header>

        <main class="main-content">
            <!-- File Selection -->
            <section class="file-section">
                <h2>üìÑ Select Document</h2>
                <div class="file-input-group">
                    <input type="text" id="filePath" placeholder="No file selected" readonly>
                    <button id="selectFileBtn" class="btn btn-primary">Browse</button>
                </div>
                <div id="filePreview" class="file-preview hidden">
                    <div class="preview-tabs">
                        <button id="rawTab" class="tab-button active">Raw</button>
                        <button id="renderedTab" class="tab-button">Rendered</button>
                    </div>
                    <div id="rawContent" class="content-tab active">
                        <pre id="fileContent"></pre>
                    </div>
                    <div id="renderedContent" class="content-tab">
                        <div id="renderedHtml"></div>
                    </div>
                </div>
            </section>

            <!-- Key Management -->
            <section class="key-section">
                <h2>üîë Bot Keys</h2>
                <div class="key-management">
                    <div class="key-selector">
                        <label for="selectedKey">Select Bot Key</label>
                        <select id="selectedKey">
                            <option value="">Loading keys...</option>
                        </select>
                        <button id="refreshKeysBtn" class="btn btn-secondary">üîÑ Refresh</button>
                    </div>
                    <div class="key-actions">
                        <button id="addKeyBtn" class="btn btn-primary">‚ûï Add Key</button>
                        <button id="deleteKeyBtn" class="btn btn-danger" disabled>üóëÔ∏è Delete</button>
                    </div>
                </div>
                <div id="keyInfo" class="key-info hidden">
                    <div class="key-details">
                        <div class="key-avatar">
                            <img id="keyAvatar" src="" alt="Profile" class="hidden">
                            <div id="keyInitials" class="key-initials"></div>
                        </div>
                        <div class="key-meta">
                            <div id="keyDisplayName" class="key-name"></div>
                            <div id="keyNpub" class="key-npub"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Relay Configuration -->
            <section class="relay-section">
                <h2>üåê Relay Configuration</h2>
                <div class="relay-management">
                    <button id="editRelaysBtn" class="btn btn-secondary">‚úèÔ∏è Edit Relays</button>
                    <div id="relayList" class="relay-list">
                        <div class="relay-item">
                            <span class="relay-url">wss://thecitadel.nostr1.com</span>
                            <span class="relay-status">Default</span>
                        </div>
                        <div class="relay-item">
                            <span class="relay-url">wss://freelay.sovbit.host</span>
                            <span class="relay-status">Default</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Configuration -->
            <section class="config-section">
                <h2>‚öôÔ∏è Configuration</h2>
                
                <div class="config-grid">
                    <div class="config-group">
                        <label for="contentKind">Content Type</label>
                        <select id="contentKind">
                            <option value="longform">Long-form Article (30023)</option>
                            <option value="publication">Publication Content (30041)</option>
                            <option value="wiki">Wiki Article (30818)</option>
                        </select>
                    </div>

                    <div class="config-group">
                        <label for="outputDir">Output Directory</label>
                        <div class="file-input-group">
                            <input type="text" id="outputDir" placeholder="Current directory" readonly>
                            <button id="selectOutputBtn" class="btn btn-secondary">Browse</button>
                        </div>
                    </div>
                </div>

                <div class="mode-selection">
                    <h3>Publication Mode</h3>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="mode" value="simple" checked>
                            <span class="radio-label">
                                <strong>Simple Standalone Article</strong>
                                <small>Single article with all content</small>
                            </span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="mode" value="hierarchical">
                            <span class="radio-label">
                                <strong>Hierarchical Publication</strong>
                                <small>Complex structure with chapters/sections</small>
                            </span>
                        </label>
                    </div>
                </div>

                <div id="hierarchicalOptions" class="hierarchical-options hidden">
                    <div class="config-group">
                        <label for="contentLevel">Content Level</label>
                        <select id="contentLevel">
                            <option value="2">Level 2 - Chapters</option>
                            <option value="3" selected>Level 3 - Sections</option>
                            <option value="4">Level 4 - Subsections</option>
                            <option value="5">Level 5 - Deep nesting</option>
                            <option value="6">Level 6 - Maximum depth</option>
                        </select>
                        <small>Headers at this level become content sections</small>
                    </div>
                </div>
            </section>

            <!-- Actions -->
            <section class="actions-section">
                <div class="action-buttons">
                    <button id="parseBtn" class="btn btn-success btn-large" disabled>
                        <span class="btn-text">Parse Document</span>
                        <span class="btn-spinner hidden">‚è≥</span>
                    </button>
                    <button id="openOutputBtn" class="btn btn-outline hidden">
                        üìÅ Open Output Folder
                    </button>
                </div>
                
                <div id="publishSection" class="publish-section hidden">
                    <h3>üöÄ Publish to Nostr</h3>
                    <div class="publish-options">
                        <button id="dryRunBtn" class="btn btn-warning">
                            üîç Dry Run
                        </button>
                        <button id="testPublishBtn" class="btn btn-info">
                            üß™ Test Publish
                        </button>
                        <button id="publishBtn" class="btn btn-success">
                            üì° Publish
                        </button>
                    </div>
                    <div class="publish-info">
                        <small>
                            <strong>Dry Run:</strong> Validate and preview without publishing<br>
                            <strong>Test Publish:</strong> Publish to test relays only<br>
                            <strong>Publish:</strong> Publish to all configured relays
                        </small>
                    </div>
                </div>
            </section>

            <!-- Results -->
            <section id="resultsSection" class="results-section hidden">
                <h2>üìä Results</h2>
                <div id="resultsContent"></div>
            </section>

            <!-- Generated Files -->
            <section id="filesSection" class="files-section hidden">
                <h2>üìÅ Generated Files</h2>
                <div id="filesList"></div>
            </section>
        </main>

        <footer class="footer">
            <p>Built with ‚ù§Ô∏è for the Nostr community</p>
            <p><a href="https://github.com/SilberWitch/Nostrbots" target="_blank">GitHub</a> | <a href="https://nostr.com" target="_blank">Nostr</a></p>
        </footer>
    </div>

    <!-- Load rendering libraries -->
    <script src="node_modules/marked/marked.min.js"></script>
    <script src="asciidoc-renderer.js"></script>
    
    <!-- Load test utilities (only in dev mode) -->
    <script>
        if (window.location.search.includes('dev=true')) {
            document.write('<script src="test-rendering.js"><\/script>');
        }
    </script>
    
    <script src="renderer.js"></script>
</body>
</html>
