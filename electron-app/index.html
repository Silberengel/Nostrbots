<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nostrbots Desktop - Document Parser</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">
                <h1>üöÄ Nostrbots Desktop</h1>
                <p>Convert documents to Nostr publications</p>
            </div>
        </header>

        <main class="main-content">
            <!-- File Selection -->
            <section class="file-section">
                <h2>üìÑ Select Document</h2>
                <div class="file-input-group">
                    <input type="text" id="filePath" placeholder="No file selected" readonly>
                    <button id="selectFileBtn" class="btn btn-primary">Browse</button>
                </div>
                <div id="filePreview" class="file-preview hidden">
                    <div class="preview-tabs">
                        <button id="rawTab" class="tab-button active">Raw</button>
                        <button id="renderedTab" class="tab-button">Rendered</button>
                    </div>
                    <div id="rawContent" class="content-tab active">
                        <pre id="fileContent"></pre>
                    </div>
                    <div id="renderedContent" class="content-tab">
                        <div id="renderedHtml"></div>
                    </div>
                </div>
            </section>

            <!-- Bot Configuration Management -->
            <section class="bot-config-section">
                <h2>ü§ñ Bot Configurations</h2>
                <div class="bot-management">
                    <div class="bot-selector">
                        <label for="selectedBot">Select Bot Configuration</label>
                        <select id="selectedBot">
                            <option value="">Loading configurations...</option>
                        </select>
                        <button id="refreshBotsBtn" class="btn btn-secondary">üîÑ Refresh</button>
                    </div>
                    <div class="bot-actions">
                        <button id="createBotBtn" class="btn btn-primary">‚ûï Create Bot</button>
                        <button id="editBotBtn" class="btn btn-secondary" disabled>‚úèÔ∏è Edit</button>
                        <button id="deleteBotBtn" class="btn btn-danger" disabled>üóëÔ∏è Delete</button>
                    </div>
                </div>
                <div id="botInfo" class="bot-info hidden">
                    <div class="bot-details">
                        <div class="bot-meta">
                            <div id="botName" class="bot-name"></div>
                            <div id="botDescription" class="bot-description"></div>
                            <div id="botEventKind" class="bot-event-kind"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Key Information -->
            <section class="key-section">
                <h2>üîë Bot Keys</h2>
                <div class="key-info">
                    <div class="info-box">
                        <p><strong>Key Management:</strong> Use the command line to manage your Nostr bot keys.</p>
                        <div class="command-examples">
                            <p><strong>Generate a new key:</strong></p>
                            <code>php manage-keys.php generate</code>
                            
                            <p><strong>Check key status:</strong></p>
                            <code>./load-keys.sh</code>
                            
                            <p><strong>Set environment variable:</strong></p>
                            <code>export NOSTR_BOT_KEY=your_private_key_here</code>
                        </div>
                        <p class="note">The GUI will automatically use the NOSTR_BOT_KEY environment variable if it's set.</p>
                    </div>
                </div>
            </section>

            <!-- Relay Configuration -->
            <section class="relay-section">
                <h2>üåê Relay Configuration</h2>
                <div class="relay-management">
                    <button id="editRelaysBtn" class="btn btn-secondary">‚úèÔ∏è Edit Relays</button>
                    <div id="relayList" class="relay-list">
                        <div class="relay-item">
                            <span class="relay-url">wss://thecitadel.nostr1.com</span>
                            <span class="relay-status">Default</span>
                        </div>
                        <div class="relay-item">
                            <span class="relay-url">wss://freelay.sovbit.host</span>
                            <span class="relay-status">Default</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Configuration -->
            <section class="config-section">
                <h2>‚öôÔ∏è Configuration</h2>
                
                <div class="config-grid">
                    <div class="config-group">
                        <label for="contentKind">Content Type</label>
                        <select id="contentKind">
                            <option value="longform">Long-form Article (30023)</option>
                            <option value="publication">Publication Content (30041)</option>
                            <option value="wiki">Wiki Article (30818)</option>
                        </select>
                    </div>

                    <div class="config-group">
                        <label for="outputDir">Output Directory</label>
                        <div class="file-input-group">
                            <input type="text" id="outputDir" placeholder="Current directory" readonly>
                            <button id="selectOutputBtn" class="btn btn-secondary">Browse</button>
                        </div>
                    </div>
                </div>

                <div class="mode-selection">
                    <h3>Publication Mode</h3>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="mode" value="simple" checked>
                            <span class="radio-label">
                                <strong>Simple Standalone Article</strong>
                                <small>Single article with all content</small>
                            </span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="mode" value="hierarchical">
                            <span class="radio-label">
                                <strong>Hierarchical Publication</strong>
                                <small>Complex structure with chapters/sections</small>
                            </span>
                        </label>
                    </div>
                </div>

                <div id="hierarchicalOptions" class="hierarchical-options hidden">
                    <div class="config-group">
                        <label for="contentLevel">Content Level</label>
                        <select id="contentLevel">
                            <option value="2">Level 2 - Chapters</option>
                            <option value="3" selected>Level 3 - Sections</option>
                            <option value="4">Level 4 - Subsections</option>
                            <option value="5">Level 5 - Deep nesting</option>
                            <option value="6">Level 6 - Maximum depth</option>
                        </select>
                        <small>Headers at this level become content sections</small>
                    </div>
                </div>
            </section>

            <!-- Actions -->
            <section class="actions-section">
                <div class="action-buttons">
                    <button id="parseBtn" class="btn btn-success btn-large" disabled>
                        <span class="btn-text">Parse Document</span>
                        <span class="btn-spinner hidden">‚è≥</span>
                    </button>
                    <button id="openOutputBtn" class="btn btn-outline hidden">
                        üìÅ Open Output Folder
                    </button>
                </div>
                
                <div id="publishSection" class="publish-section hidden">
                    <h3>üöÄ Publish to Nostr</h3>
                    <div class="publish-options">
                        <button id="dryRunBtn" class="btn btn-warning">
                            üîç Dry Run
                        </button>
                        <button id="testPublishBtn" class="btn btn-info">
                            üß™ Test Publish
                        </button>
                        <button id="publishBtn" class="btn btn-success">
                            üì° Publish
                        </button>
                    </div>
                    <div class="publish-info">
                        <small>
                            <strong>Dry Run:</strong> Validate and preview without publishing<br>
                            <strong>Test Publish:</strong> Publish to test relays only<br>
                            <strong>Publish:</strong> Publish to all configured relays
                        </small>
                    </div>
                </div>
            </section>

            <!-- Results -->
            <section id="resultsSection" class="results-section hidden">
                <h2>üìä Results</h2>
                <div id="resultsContent"></div>
            </section>

            <!-- Generated Files -->
            <section id="filesSection" class="files-section hidden">
                <h2>üìÅ Generated Files</h2>
                <div id="filesList"></div>
            </section>
        </main>

        <footer class="footer">
            <p>Built with ‚ù§Ô∏è for the Nostr community</p>
            <p><a href="https://github.com/SilberWitch/Nostrbots" target="_blank">GitHub</a> | <a href="https://imwald.eu" target="_blank">My Nostr Homepage</a></p>
        </footer>
    </div>

    <!-- Load rendering libraries -->
    <script src="node_modules/marked/marked.min.js"></script>
    <script src="asciidoc-renderer.js"></script>
    
    <!-- Bot Configuration Modals -->
    <div id="createBotModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Bot Configuration</h3>
                <button class="modal-close" id="closeCreateBotModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="newBotName">Bot Name</label>
                    <input type="text" id="newBotName" placeholder="my-bot" required>
                    <small>Use lowercase letters, numbers, and hyphens only</small>
                </div>
                <div class="form-group">
                    <label for="newBotType">Content Type</label>
                    <select id="newBotType">
                        <option value="longform">Long-form Article (30023)</option>
                        <option value="publication">Publication Content (30041)</option>
                        <option value="wiki">Wiki Article (30818)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="newBotConfig">Configuration</label>
                    <textarea id="newBotConfig" rows="20" placeholder="Loading template..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelCreateBot" class="btn btn-secondary">Cancel</button>
                <button id="saveCreateBot" class="btn btn-primary">Create Bot</button>
            </div>
        </div>
    </div>

    <div id="editBotModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Bot Configuration</h3>
                <button class="modal-close" id="closeEditBotModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="editBotName">Bot Name</label>
                    <input type="text" id="editBotName" readonly>
                </div>
                <div class="form-group">
                    <label for="editBotConfig">Configuration</label>
                    <textarea id="editBotConfig" rows="20"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelEditBot" class="btn btn-secondary">Cancel</button>
                <button id="saveEditBot" class="btn btn-primary">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Load test utilities -->
    <script src="test-rendering.js"></script>
    
    <script src="renderer.js"></script>
</body>
</html>
